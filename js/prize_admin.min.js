$(document).ready(function(){$(".add-data").dialog({autoOpen:!1,modal:!0,resizable:!1,show:{effect:"clip",duration:200},hide:{effect:"drop",duration:200},close:function(){$(".add-name").removeClass("active")},buttons:{"\u53d6\u6d88":function(){$(this).dialog("close")},"\u5132\u5b58":addData}});$(".revise-data").dialog({autoOpen:!1,modal:!0,resizable:!1,show:{effect:"highlight",duration:200},hide:{effect:"drop",duration:200},close:function(){$(".revise-name").parent().parent().removeClass("selected")},
buttons:{"\u53d6\u6d88":function(){$(this).dialog("close")},"\u5132\u5b58":modifyData}});$(".del-data").dialog({title:"\u522a\u9664\u734e\u54c1",autoOpen:!1,modal:!0,resizable:!1,show:{effect:"bounce",duration:200},hide:{effect:"drop",duration:200},close:function(){$(".del-name").parent().parent().removeClass("selected")},buttons:{"\u53d6\u6d88":function(){$(this).dialog("close")},"\u78ba\u8a8d":delData}});$(".reset-data").dialog({title:"\u91cd\u7f6e\u734e\u54c1",autoOpen:!1,modal:!0,resizable:!1,
show:{effect:"bounce",duration:200},hide:{effect:"drop",duration:200},close:function(){$(".reset-time").removeClass("active")},buttons:{"\u53d6\u6d88":function(){$(this).dialog("close")},"\u78ba\u8a8d":resetData}});$(document).on("keypress",function(a){13===a.keyCode&&a.preventDefault()});$(".sel-all").on("click",function(){queryData(1)});$(".sel-part").on("click",function(){queryData(2)});$(".add-name").on("click",function(){$(this).addClass("active");$("#ui-id-2").html("\u65b0\u589e\u734e\u54c1");
$(".add-data").dialog("open")});$(".reset-time").on("click",function(){$(this).addClass("active");$(".reset-data").dialog("open")});queryData(1)});
function queryData(a){1===a?$(".sel-part").removeClass("active").prev().addClass("active"):$(".sel-all").removeClass("active").next().addClass("active");$.ajax({url:"admin_api.php",method:"POST",dataType:"json",data:{operType:1,selType:a},success:function(a){loadData(a)},error:function(){$("tbody").empty().append("<tr><td colspan='6'>\u6578\u64da\u52a0\u8f09\u5931\u6557\uff01\u8acb\u6aa2\u67e5\u7db2\u7d61\u9023\u63a5\u6216\u53cd\u994b\u7ba1\u7406\u54e1\u3002</td></tr>");$(".prize-count>span").html(0)}})}
function loadData(a){if(0===a.length)$("tbody").empty().append("<tr><td colspan='6'>\u6578\u64da\u5eab\u734e\u54c1\u70ba\u7a7a\uff01\u8acb\u65b0\u589e\u734e\u54c1\u3002</td></tr>");else{$("tbody").empty();for(var c=0;c<a.length;c++){var b=a[c],d=b.rp_id,f=b.rp_name,g=b.rp_create_datetime,e="<td></td><td></td>";null===b.rp_used_datetime?(b="\u5c1a\u672a\u9818\u53d6",e="<td><button class='revise-name'>\u4fee\u6539</button></td><td><button class='del-name'>\u522a\u9664</button></td>"):b=b.rp_used_datetime;
$("tbody").append(`<tr><td>${d}</td><td class='${d}'>${f}</td>`+`<td>${g}</td><td>${b}</td>${e}</tr>`)}$(".revise-name").on("click",function(){$(this).parent().parent().addClass("selected");var a=parseInt($(this).parent().parent().children("td:nth-child(1)").text()),b=$(`.${a}`).text();$(".revise-data input").val(b);$("#ui-id-4").html("\u4fee\u6539\u734e\u54c1");$(".revise-data").data("prizeId",a).dialog("open")});$(".del-name").on("click",function(){$(this).parent().parent().addClass("selected");
var a=parseInt($(this).parent().parent().children("td:nth-child(1)").text());$(".del-data").data("prizeId",a).dialog("open")});$(".prize-count>span").html($("tbody>tr").length)}}
function delData(){var a=$(this).data("prizeId");$.ajax({url:"admin_api.php",method:"POST",dataType:"json",data:{operType:2,prizeId:a,selType:$(".sel-all").hasClass("active")?1:2},success:function(a){loadData(a)},error:function(){$("tbody").empty().append("<tr><td colspan='6'>\u6578\u64da\u52a0\u8f09\u5931\u6557\uff01\u8acb\u6aa2\u67e5\u7db2\u7d61\u9023\u63a5\u6216\u53cd\u994b\u7ba1\u7406\u54e1\u3002</td></tr>");$(".prize-count>span").html(0)}});$(this).dialog("close")}
function modifyData(){var a=$(this).data("prizeId"),c=$(`.${a}`).text(),b=$("#revise-prize").val();allSpace(b)?($("#revise-prize").val(""),$("#ui-id-4").html("\u734e\u54c1\u540d\u7a31\u4e0d\u80fd\u70ba\u7a7a\uff01")):(b!==c&&$.ajax({url:"admin_api.php",method:"POST",dataType:"json",data:{operType:3,prizeId:a,prizeName:b,selType:$(".sel-all").hasClass("active")?1:2},success:function(a){loadData(a)},error:function(){$("tbody").empty().append("<tr><td colspan='6'>\u6578\u64da\u52a0\u8f09\u5931\u6557\uff01\u8acb\u6aa2\u67e5\u7db2\u7d61\u9023\u63a5\u6216\u53cd\u994b\u7ba1\u7406\u54e1\u3002</td></tr>");
$(".prize-count>span").html(0)}}),$(this).dialog("close"))}
function addData(){if(allSpace($("#add-prize").val()))$("#add-prize").val(""),$("#ui-id-2").html("\u734e\u54c1\u540d\u7a31\u4e0d\u80fd\u70ba\u7a7a\uff01");else{var a=$("#add-prize").val();$.ajax({url:"admin_api.php",method:"POST",dataType:"json",data:{operType:4,prizeName:a,selType:$(".sel-all").hasClass("active")?1:2},success:function(a){loadData(a)},error:function(){$("tbody").empty().append("<tr><td colspan='6'>\u6578\u64da\u52a0\u8f09\u5931\u6557\uff01\u8acb\u6aa2\u67e5\u7db2\u7d61\u9023\u63a5\u6216\u53cd\u994b\u7ba1\u7406\u54e1\u3002</td></tr>");$(".prize-count>span").html(0)}});
$("#add-prize").val("");$(this).dialog("close")}}function resetData(){$.ajax({url:"admin_api.php",method:"POST",dataType:"json",data:{operType:5,selType:$(".sel-all").hasClass("active")?1:2},success:function(a){loadData(a)},error:function(){$("tbody").empty().append("<tr><td colspan='6'>\u6578\u64da\u52a0\u8f09\u5931\u6557\uff01\u8acb\u6aa2\u67e5\u7db2\u7d61\u9023\u63a5\u6216\u53cd\u994b\u7ba1\u7406\u54e1\u3002</td></tr>");$(".prize-count>span").html(0)}});$(this).dialog("close")}
function allSpace(a){return 0===a.replace(/\s+/g,"").length?!0:!1};